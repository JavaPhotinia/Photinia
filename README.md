# Photinia
This document is to help users reproduce the results we reported in our submission. It contains the following descriptions

## 0. Artifact Expectation

The tools (such as [PhoCheck](https://github.com/JavaPhotinia/PhoCheck)) and [experimental results](https://github.com/JavaPhotinia/Photinia_Data) mentioned in the paper are all stored in the repository of *JavaPhotonia* users. **We run all the experiments on a Docker environment which was deployed on a  machine  with 128GB RAM and  48 cores of CPU.** Both can be executed using Docker 20.10.8. We hope that users can reproduce our experiments using this version or a later version of Docker. For experiments with no specific performance requirements (such as those not based on the DOOP framework), results can also be obtained using a personal computer.

## 1. Environment Setup

Photinia provides two usage methods based on the Soot framework and the DOOP framework, respectively. The following will explain how to configure them.

### 1.1. Soot

* Pull Photinia from GitHub.

```
$ git clone https://github.com/JavaPhotinia/Photinia.git
```

* Open Photinia with IntelliJ IDEA.
* Modify the ```.../src/main/resources/config.properties``` so that Photinia can analyze the local project under test.
  * **benchmark_base_path:** change to the absolute path where the benchmark is located
  * **benchmark_name:** the name of the project that needs to be tested
  * **bean_xml_paths:**  the  absolute path of Spring bean configuration file in project under test
  * **shiro_xml_paths: **the  absolute path of Shiro configuration file in project under test
  * **web_xml_paths:** the  absolute path of web.xml configuration file in project under test     

* Run ```ParserSpringMain.main()```.

### 1.2. DOOP

Execute the Dockerfile in the Photinia repository to generate a docker container, `/localdata` is the folder path of your machine. Please change it according to the actual situation.

* Pull Photinia from GitHub.

``` 
$ git clone https://github.com/JavaPhotinia/Photinia.git
$ cd Photinia
```

* Built docker

```
$ docker build -t photinia:v1 .
$ docker run -it -h Photinia.gt --privileged=True -e "container=docker" -v /localdata:/data --net=host --name="Photinia" photinia:v1 bash
```

## 2. Tab Section 5.1

This tab shows the improvement of Photinia detection ability of Jasmine, including Table 2, Table 3, and Table 4. Due to differences in the performance of the relevant machines, there may be some minor differences in the correlation results.

### 2.1 Results on Production-benchmark

Experimental results reference:

https://github.com/JavaPhotinia/Photinia_Data/tree/main/summary

https://github.com/JavaPhotinia/Photinia_Data/tree/main/benchmark-result

* Run the```runjasmine.py``` provided in Docker to obtain Jasmine related results.

  ```
  $ bash /root/TurnOnJasmine.bash
  $ python3 /root/newdoop/runjasmine.py
  $ bash /root/TurnOffJasmine.bash
  ```

* Run the```runphotinia.py``` provided in Docker to obtain Photinia related results.

  ```
  $ bash /root/TurnOnPhotinia.bash
  $ python3 /root/newdoop/runphotinia.py
  $ bash /root/TurnOffPhotinia.bash
  ```

### 2.2 Proportion of edges added in Photinia

Experimental results reference: 

https://github.com/JavaPhotinia/Photinia_Data/tree/main/addEdges

The [benchmark-result](https://github.com/JavaPhotinia/Photinia_Data/tree/main/benchmark-result) results generated by 2.1 were analyzed using [AnalysisResult/AnalysisEdgesAndMethods.jar](https://github.com/JavaPhotinia/Photinia/tree/main/AnalysisResult), which comes with Photinia, to obtain the percentage of call edge increase and the percentage of reachable methods.

* Modify the relevant path information in ```AnalysisResult/config.properties``` according to the actual path generated by the 2.1 result.
* Run ```AnalysisEdgesAndMethods.jar```.

```
$ java -jar AnalysisEdgesAndMethods-1.0-SNAPSHOT.jar  -c config.properties
```

### 2.3 App  methods  reachability

Experimental results reference: 

https://github.com/JavaPhotinia/Photinia_Data/tree/main/benchmark-result

Run ```AnalysisEdgesAndMethods.jar```.

```
$ java -jar AnalysisEdgesAndMethods-1.0-SNAPSHOT.jar  -c config.properties
```

## 3. Tab Section 5.2

Experimental results reference: 

https://github.com/JavaPhotinia/Photinia_Data/tree/main/summary

Record time and memory directly from the relevant result file, where the time unit of the original data is seconds and the memory consumption unit is KB.

## 4. Tab Section 5.3

* Pull PhoCheck and FlowDroidPlus from GitHub.

```
$ git clone https://github.com/JavaPhotinia/PhoCheck.git
$ git clone https://github.com/SpringJasmine/FlowDroid_Jasmine.git
```

* Open PhoCheck with IntelliJ IDEA.
* Modify the relevant path information in ```src/main/java/org/Main.java```.

```java
6:   public class BenchmarksConfig {
7:       private static String basePath = "";
8:       public static List<String> getSourceProcessDir(String benchmark) {
9:           List<String> dir = new ArrayList<>();
...
181:     }
182: }
```

* Run ```Main.main()```.
* Record Sink information for console output (Benchmark related Source and Sink collections have been saved to [FlowDroidExtend](https://github.com/JavaPhotinia/FlowDroidExtend)).
* Open FlowDroidPlus with IntelliJ IDEA.
* Replace the files under ```dataleak/dist``` with the [jar](https://github.com/JavaPhotinia/FlowDroidExtend/blob/main/PointerAnalysis-1.0-SNAPSHOT.jar) provided by Photinia.

* Add [AuthBrokenSourceAndSink](https://github.com/JavaPhotinia/FlowDroidExtend/tree/main/AuthBrokenSourceAndSink) and [SQLInjectSourceAndSink](https://github.com/JavaPhotinia/FlowDroidExtend/tree/main/SQLInjectSourceAndSink) inside ```soot-infoflow-android```.
* Modify the relevant path information in ```dataleak/Main.java```.

```java
11: public class Main {
12:    private static final Logger LOGGER = LoggerFactory.getLogger(Main.class);
13:    public static String benchmark = "jeesite";
14:    public static String analysisAlgorithm = "jasmine";
...
29:        application.runInfoflow(System.getProperty("user.dir") + File.separator + "soot-infoflow-android/SQLInjectSourceAndSink/SourcesAndSinks-"+ benchmark +".txt");
30:    }
31: }
```

* Run ```Main.main()``` in ```dataleak```.
